<html>
<head>

    <!-- CSS -->
    <link rel="stylesheet" href="{{ asset('bundles/livevoting/css/bootstrap.css') }}">
    <link rel="stylesheet" href="{{ asset('bundles/livevoting/css/style.css') }}">
    <link rel="stylesheet" href= "{{ asset('bundles/livevoting/css/normalize.css') }}"  />

    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="http://code.highcharts.com/highcharts.js"></script>

    <style type="text/css">
       
    </style>
</head>
<body>

<div class="navbar navbar-default navbar-collapse">
    <div class="container">
        <div class="navbar-header">         
            <ul class="list-inline list-unstyled text-center">
                <li>
                    <a href="{{ path('index') }}">
                      <img width="25" height="25" src="{{ asset('bundles/livevoting/img/kruzici.svg') }}" class="img-responsive" alt="logo">
                    </a>
                </li>
                <li>
                    <h3>Final results for:</h3>
                </li>
                <li>
                    <h3><a href="{{ path('event', {'event_id':event_id}) }}">{{ event_name }}</a></h3>
                </li>
            </ul>
        </div>
    </div>
</div>

<div id="high" style="width:100%; height:400px;"></div>

<div id="footer-index">
    <div id="footer" class="container">
        <ul class="list-inline list-unstyled">
            <li class="hidden-xs">
                <img width="20" height="20" alt="Netgen" src="{{ asset('bundles/livevoting/img/kruzici.svg')}}" >
            </li>
            <li>
                <a href="http://www.netgenlabs.com">Netgenlabs.com</a>
            </li>
            <li class="hidden-xs" style="margin-left:3rem;">
                <img width="20" height="20" alt="GitHub Mark" src="{{ asset('bundles/livevoting/img/GitHub-Mark.png')}}">
            </li>
            <li>
                <a href="https://github.com/netgen/LiveVoting">GitHub project</a>
            </li>
        </ul>
    </div>
</div>

<div id="winner">
    <h4>And the winner is:</h4> 
    <div class="circle-container">
        <div class="alert alert-info" role="alert">
            <span class="glyphicon glyphicon-star deg0"></span>
            <span class="glyphicon glyphicon-star deg45"></span>
            <span class="glyphicon glyphicon-star deg135"></span>
            <span class="glyphicon glyphicon-star deg180"></span>
            <span class="glyphicon glyphicon-star deg225"></span>
            <span class="glyphicon glyphicon-star deg315"></span>
            <h2 class="winner"></h2>
        </div> 
    </div>
</div>
</body>
<script type="text/javascript">
    var requestData, animation_data, chart, data;
    var callMe = function(){
        setTimeout(setPresentationData, 1000);
    };

    requestData = function(index){
        if(index>=animation_data.length){
            endEverything();
            return;
        }
        var data = [];
        var avg;
        for(var i in animation_data[index]){
            avg = parseFloat(animation_data[index][i]['average']);
            data.push(avg);
        }

        chart.series[0].setData(data);
        setTimeout(function(){requestData(index+1)}, 1000);

    }

    function endEverything(){
        $('#winner .winner').html(data['winner']['presenter']['name']+' '+data['winner']['presenter']['surname']);
        //$(".circle-container").scrollTop($(".circle-container")[0].scrollHeight);
        setTimeout(function(){
            $('#winner').fadeIn(2000,
                function(){
                    $("body").scrollTop($("#winner").offset().top - 200);
                    setTimeout(function(){
                       $('#winner .winner').fadeIn(1000);
                    },100);
                }
            );

        },1000);
    }

    function setPresentationData(){
        if(!animation_data.length)return;
        var data = [];
        var categories = [];
        for(var ii in animation_data[0]){
            categories.push(animation_data[0][ii]['presenter']['name']+' '+animation_data[0][ii]['presenter']['surname']);
            data.push(0);
        }
        chart.xAxis[0].update({categories: categories}, true);
        chart.series[0].setData(data);
        setTimeout(function(){requestData(0)}, 1000);
    }


    (function(){

        data = jQuery.parseJSON('{{ animation_data|raw }}');
        animation_data = data['animation_data'];
        $('#winner').hide();
        $('#winner .winner').hide();

        var presentationIndex = {};
        chart = new Highcharts.Chart({
            chart: {
                renderTo: 'high',
                defaultSeriesType: 'column',
                events: {
                    load: function(){
                        setTimeout(setPresentationData, 1000);
                    }
                }
            },
            plotOptions: {
                column:{
                    colorByPoint: true
                }
            },
            //colors: ['#2f7ed8', '#0d233a', '#8bbc21', '#910000', '#1aadce',
            //    '#492970', '#f28f43', '#77a1e5', '#c42525', '#a6c96a'],
            title: {
                text: 'Results for {{ event_name }}'
            },
            xAxis: {
                type: 'String',
                tickPixelInterval: 5
            },
            yAxis: {
                minPadding: 0.1,
                maxPadding: 0.1,
                tickmarkPlacement: 'on',
                min: 0,
                max: 5,
                title: {
                    text: 'Average number of rating score'
                }
            },
            series: [
                {
                    showInLegend: false,
                    data:[],
                    dataLabels: {
                        enabled: true,
                        rotation: 0,
                        formatter: function() {
                            return this.y;
                        },
                        style: {
                            fontSize: '13px'
                        }
                    }
                }]
        });

    })();
</script>
</html>